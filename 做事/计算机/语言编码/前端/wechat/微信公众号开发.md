https://www.shouce.ren/api/view/a/15502

## 微信公众号简介

### 简介
 是在微信的基础上新增的功能模块，通过这一平台，个人和企业都可以打造一个微信的公众号，并实现和特定群体的文字、图片、语音的全方位沟通、互动。
 
### 通讯机制

微信用户  --  微信后台服务器 -- 公众账号

### 公众号分类及配置

1. 开发者需要在微信公众平台注册一个公众号开发者账号。公众号分为服务号和订阅号，不同类型的公众号具备不同的公众平台的接口权限。

2. 在公众平台配置自己的域名和服务器(URL 和  Token)，开发者的服务器与微信公众平台进行对接。
   JS 安全域名，接口权限设置，IP白名单

### 使用测试号开发
![](../images/测试.png)

1. 在申请到认证公众号之前，可以先通过测试号申请系统，快速申请一个接口测试号，立即开始接口测试开发。

测试账号
https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&t=sandbox/index


2. 在开发过程中，可以使用接口调试工具来在线调试某些接口。
接口 调试工具 https://mp.weixin.qq.com/debug
微信 JS 接口签名校验工具  https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign

3. 每个接口都有每日接口调用频次限制，可以在公众平台官网-设置与开发-运维中心处查看具体频次
4. 在开发出现问题时，可以通过接口调用的返回码，以及报警排查指引（在微信公众平台官网-开发者中心处可以设置接口报警），开发发现和解决问题

5.公众平台以 access_token 为接口调用凭据，来调用接口，所有接口的调用需要先获取 access_token，access_token 在2小时内有效，过期需要重新获取，但1天内获取次数有限，开发者需自行存储。
6.公众平台接口调用仅支持80端口。


### 公众号用户的识别

微信用户在公众号内的请求会携带一个 OpenID 的参数，来标识一个用户。每个用户对每个公众号都会产生一个唯一的 OpenID。如果需要在多个公众号之间做用户共通，需要将这些公众号和应用绑定到一个开发平台账号下，绑定后，一个用户对多个公众号依然有多个不同的 OpenID，但一个用户只有一个唯一的 UnionID。


### 获取 Access token (2小时内有效，超过要重新通过此接口获取)

调用微信公众平台接口之前，必须获取 access_token，access_token 时公众号的全局唯一调用凭据，公众号调用公众平台的接口时都需要使用 access_token 作为参数。

请求
``` 
https请求方式: GET 
URL: https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=APPID&secret=APPSECRET

```
https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=wx99646f923379d46c&secret=278efd92cff364c798fa32b3970b1cea

$appid = wx99646f923379d46c
$appKey = 278efd92cff364c798fa32b3970b1cea

成功返回信息如下
``` 
{"access_token":"ACCESS_TOKEN","expires_in":7200}
```
{
    "access_token": "55_dO0wy48tYNQ6lO9ZYu6a0iO0Vyz8iM7vIO_hzoZ3z1iyRqXYfS8ppmnkuQwJdoDrFQbIcCv5-cT7elRca3XQfjTQhdbrJNWq-lSu0IigDIBV1IFyzJ0VAy_62NY-FCmma7RDBQwNJsc3jNmdCTScAGAOFE", 
    "expires_in": 7200
}

### IP 白名单
在 IP 白名单内的IP来源，获取 access_token 接口才可调用成功。
测试号不用设置

